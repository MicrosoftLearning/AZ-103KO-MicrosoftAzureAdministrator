---
lab:
    title: '거버넌스 및 준수'
    module: '모듈 11 - 거버넌스 및 준수'
---

# 랩: 거버넌스 구현 및 Azure 이니셔티브와 리소스 잠금 규정 준수

이 랩의 모든 작업은 Azure Portal(PowerShell Cloud Shell 세션 포함)에서 수행됩니다.  

   > **참고**: Cloud Shell을 사용하지 않는 경우 랩 가상 머신에 Azure PowerShell 1.2.0 모듈(또는 최신 모듈)이 설치되어 있어야 합니다. [https://docs.microsoft.com/ko-kr/powershell/azure/install-az-ps](https://docs.microsoft.com/ko-kr/powershell/azure/install-az-ps)

랩 파일: 

-  **Labfiles\\Module_11\\Governance_and_Compliance\\AZ-100.1\\az-100-01b_azuredeploy.json**

-  **Labfiles\\Module_11\\Governance_and_Compliance\\az-100-01b_azuredeploy.parameters.json**

### 시나리오
  
Adatum Corporation은 Azure 정책 및 이니셔티브를 사용하여 Azure 구독에서 리소스 태그 지정을 적용하려 합니다. 환경이 규정 준수를 달성하면, Adatum은 리소스 잠금을 구현하여 의도하지 않은 변경을 방지하고자 합니다.

### 목표
  
이 랩을 완료하면 다음과 같은 역량을 갖추게 됩니다.

-  Azure 정책 및 이니셔티브를 사용하여 Azure 태그 구현

-  Azure 리소스 잠금 구현


### 연습 1: Azure 정책 및 이니셔티브를 사용하여 Azure 태그 구현

이 연습의 주요 작업은 다음과 같습니다.

1. Azure Resource Manager 템플릿을 사용하여 Azure 리소스를 프로비전합니다.

1. 리소스 태그 지정 규정 준수를 평가하는 이니셔티브 및 정책을 구현합니다.

1. 리소스 태그 지정 규정 준수를 적용하는 정책을 구현합니다.

1. 태그 지정 적용 및 태그 지정 규정 준수를 평가합니다.

1. 리소스 태그 지정 규정 비준수에 대한 수정을 구현합니다.

1. 수정 작업이 규정 준수에 미치는 영향을 평가합니다.


#### 작업 1: Azure Resource Manager 템플릿을 사용하여 Azure 리소스를 프로비전합니다.

1. 랩 가상 머신에서 Microsoft Edge를 시작하고 [**http://portal.azure.com**](http://portal.azure.com)에서 Azure Portal을 찾아보고 이 랩에서 사용하려는 Azure 구독에서 소유자 역할이 있는 Microsoft 계정을 사용하여 로그인합니다.

1. Azure Portal에서 **리소스 만들기** 블레이드로 이동합니다.

1. **리소스 만들기** 블레이드에서 Azure Marketplace에서 **템플릿 배포**를 검색합니다.

1. 검색 결과 목록을 사용하여 **사용자 지정 배포** 블레이드로 이동합니다.

1. **사용자 지정 배포** 블레이드에서 **편집기에서 고유한 템플릿 빌드**를 선택합니다.

1. **템플릿 편집** 블레이드에서 템플릿 파일 **az-100-01b_azuredeploy.json**을 로드합니다. 

   > **참고**: 템플릿의 내용을 검토하고 일부 리소스의 태그를 포함하여 Windows Server 2016 데이터 센터를 호스팅하는 Azure VM의 배포를 정의합니다.

1. 템플릿을 저장하고 **사용자 지정 배포** 블레이드로 돌아갑니다. 

1. **사용자 지정 배포** 블레이드에서 **매개 변수 편집** 블레이드로 이동합니다.

1. **편집 매개 변수** 블레이드에서 매개 변수 파일 **az-100-01b_azuredeploy.parameters.json**을 로드합니다. 

1. 매개 변수를 저장하고 **사용자 지정 배포** 블레이드로 돌아갑니다. 

1. **사용자 지정 배포** 블레이드에서 다음 설정으로 템플릿 배포를 시작합니다:

    - 구독: 이 랩에서 사용 중인 구독의 이름

    - 리소스 그룹: 새 리소스 그룹 **az1000101b-RG**의 이름

    - 위치: 랩 위치에 가장 가까운 Azure 지역의 이름 및 Azure VM을 프로비전할 수 있는 위치

    - Vm 크기: **Standard_DS1_v2**

    - VM 이름: **az1000101b-vm1**

    - 관리자 사용자 이름: **학생**

    - 관리자 암호: **Pa55w.rd1234**

    - 가상 네트워크 이름: **az1000101b-vnet1**

    - 환경 이름: **lab**

   > **참고**: Azure VM을 프로비전할 수 있는 Azure 지역을 확인하려면 [**https://azure.microsoft.com/ko-kr/regions/offers/**](https://azure.microsoft.com/ko-kr/regions/offers/)을 참고하십시오.

   > **참고**: 배포가 완료되기를 기다리지 말고 다음 단계를 진행하세요.
   
1. Azure Portal에서 **태그** 블레이드로 이동합니다.

1. **태그** 블레이드에서 **환경** 태그의 값을 **lab**으로 설정하여 모든 리소스를 표시합니다. 이전 작업에 배포된 리소스 중 일부에만 이 태그가 할당됩니다.

   > **참고**: 이 시점에서 프로비전된 리소스는 일부입니다. 하지만, 태그가 할당되지 않은 리소스 몇 개는 확인할 수 있을 것입니다.


#### 작업 2: 리소스 태그 지정 규정 준수를 평가하는 정책과 이니셔티브를 구현합니다.

1. Azure Portal에서 **정책** 블레이드로 이동합니다.

1. **정책** 블레이드에서 **정책 - 정의** 블레이드로 이동합니다.

1. **정책 정의** 블레이드에서 **태그와 해당 값이 필요합니다.** 정책 정의를 표시합니다.

1. **태그 및 기본값 필요** 정책 정의 블레이드에서 정의 복제 기능을 사용하여 다음 설정으로 새 정책을 만듭니다.

    - 정의 위치: 이 랩에서 사용 중인 구독의 이름

    - 이름: **az10001b - 감사 태그 및 해당 값**

    - 설명: **필요한 태그와 해당 값을 감사합니다. 리소스 그룹에는 적용되지 않습니다.**

    - 범주: 새 범주 **랩**의 이름

    - 정책 규칙: 기존 정책 규칙에서 정책 정의에 다음 내용이 포함되도록 **effect**를 **deny**에서 **audit**로 변경합니다.

```json
   {
     "mode": "indexed",
     "policyRule": {
       "if": {
         "not": {
           "field": "[concat('tags[', parameters('tagName'), ']')]",
           "equals": "[parameters('tagValue')]"
         }
       },
       "then": {
         "effect": "audit"
       }
     },
     "parameters": {
       "tagName": {
         "type": "String",
         "metadata": {
           "displayName": "Tag Name",
           "description": "Name of the tag, such as 'environment'"
         }
       },
       "tagValue": {
         "type": "String",
         "metadata": {
           "displayName": "Tag Value",
           "description": "Value of the tag, such as 'production'"
         }
       }
     }
   }
```

1. **정책 - 정의** 블레이드에서 **새 이니셔티브 정의** 블레이드로 이동합니다.

1. **새 이니셔티브 정의** 블레이드에서 다음 설정으로 새 이니셔티브 정의를 만듭니다.

    - 정의 위치: 이 랩에서 사용 중인 구독의 이름

    - 이름: **az10001b - 태그 지정 이니셔티브**

    - 설명: **태그 정책의 컬렉션**

    - 범주: **랩**

    - 사용 가능한 정의: **az10001b - 감사 태그 및 해당 값**을 검색하고 선택합니다.

        - 태그 이름: **environment**

        - 태그 값: **lab**

1. **정책 - 할당** 블레이드로 이동합니다.

1. **정책 - 할당** 블레이드에서 **이니셔티브 할당**블레이드 이동하여 다음 설정으로 새 이니셔티브 할당을 만듭니다:

    - 범위: 이 랩에서 사용 중인 구독의 이름

    - 제외: 없음 

    - 이니셔티브 정의: **az10001b - 태그 지정 이니셔티브**

    - 과제 이름: **az10001b - 이니셔티브 할당 태그 지정**

    - 설명: **az10001b 할당 - 태그 지정 이니셔티브**

    - 할당: 기본값

    - 관리 ID 만들기: **선택 취소됨**

1. **정책 - 규정 준수** 블레이드로 이동합니다. **규정 준수 상태**는 **등록되지 않음** 또는 **시작되지 않음**으로 설정되어 있습니다.

   > **참고**: 평균적으로 규정 준수 검사 시작에 약 10분이 걸립니다. 규정 준수 검사를 기다리지 말고 다음 작업을 진행합니다. 이 연습의 후반부에서 규정 준수 상태를 검토할 것입니다.


#### 작업 3: 리소스 태그 지정 규정 준수를 적용하는 정책을 구현합니다.

1. **정책 - 정의** 블레이드로 이동합니다.

1. **정책 - 정의** 블레이드에서 **az10001b로 이동 - 태그 지정 이니셔티브** 블레이드로 이동합니다.

1. **az10001b - 태그 지정 이니셔티브** 블레이드에서 **이니셔티브 정의 편집** 블레이드로 이동합니다.

1. **태그 및 해당 값 필요**라는 기본 제공 정책을 이니셔티브에 추가하고 해당 매개 변수를 다음 값으로 설정합니다.

    - 태그 이름: **environment**

    - 태그 값: **lab**

   > **참고**: 이 시점에서 이니셔티브에는 두 가지 정책이 포함되어 있습니다. 첫 번째는 규정 준수 상태를 평가하고 두 번째는 배포 중에 태그 지정을 적용합니다. 


#### 작업 4: 태그 지정 적용 및 태그 지정 규정 준수를 평가합니다.

1. Azure Portal에서 **리소스 블레이드 만들기**로 이동합니다.

1. **새** 블레이드에서 Azure Marketplace에 **템플릿 배포**를 검색합니다.

1. 검색 결과 목록을 사용하여 **사용자 지정 배포** 블레이드로 이동합니다.

1. **사용자 지정 배포** 블레이드에서 **편집기에서 고유한 템플릿 빌드**를 선택합니다.

1. **템플릿 편집** 블레이드에서 템플릿 파일 **az-100-01b_azuredeploy.json**을 로드합니다. 

   > **참고**: 이 템플릿은 이 연습의 첫 번째 작업에서 배포에 사용한 템플릿과 동일합니다. 

1. 템플릿을 저장하고 **사용자 지정 배포** 블레이드로 돌아갑니다. 

1. **사용자 지정 배포** 블레이드에서 **매개 변수 편집** 블레이드로 이동합니다.

1. **편집 매개 변수** 블레이드에서 매개 변수 파일 **az-100-01b_azuredeploy.parameters.json**을 로드합니다. 

1. 매개 변수를 저장하고 **사용자 지정 배포** 블레이드로 돌아갑니다. 

1. **사용자 지정 배포** 블레이드에서 다음 설정으로 템플릿 배포를 시작합니다:

    - 구독: 이 랩에서 사용 중인 구독의 이름

    - 리소스 그룹: 새 리소스 그룹 **az1000102b-RG**의 이름

    - 위치: 이 연습의 첫 번째 작업에서 선택한 Azure 지역의 이름

    - VM 크기: **Standard_DS1_v2**

    - VM 이름: **az1000102b-vm1**

    - 관리자 사용자 이름: **학생**

    - 관리자 암호: **Pa55w.rd1234**

    - 가상 네트워크 이름: **az1000102b-vnet1**

    - 환경 이름: **lab**

   > **참고**: 배포가 실패합니다. 예상한 상황입니다.

1. 메시지가 유효성 검사 오류를 표시합니다. 리소스 **az1000102b-vnet1**의 배포가 **az10001b - 태그 지정 이니셔티브 할당**에 포함된 **태그 및 해당 값 필요** 정책에 의해 허용되지 않음을 나타내는 오류 세부 정보를 검토합니다.

1. **정책 - 규정 준수** 블레이드로 이동합니다. **규정 준수 상태** 열의 항목을 식별합니다.

1. **az10001b - 태그 지정 이니셔티브 할당** 블레이드로 이동하고 규정 준수 상태 요약을 검토합니다.

1. 리소스 규정 준수 목록을 표시하고 비준수로 식별된 리소스를 확인합니다. 

   > **참고**: **정책 - 규정 준수** 블레이드에서 **새로 고침** 단추를 클릭하여 규정 준수 상태에 대한 업데이트를 확인하세요. 


#### 작업 5: 리소스 태그 지정 규정 비준수 사항에 대한 수정을 구현합니다.

1. Azure Portal에서 **az10001b - 태그 지정 이니셔티브** 블레이드로 이동합니다.

1. **az10001b - 태그 지정 이니셔티브** 블레이드에서 **이니셔티브 정의 편집** 블레이드로 이동합니다.

1. **태그 및 기본값 추가**라는 기본 제공 정책 정의를 이니셔티브에 추가하고 해당 매개 변수를 다음 값으로 설정합니다.

    - 태그 이름: **environment**

    - 태그 값: **lab**

1. 이니셔티브에서 **az10001b - 태그와 해당 값을 감사합니다**라는 이름의 사용자 지정 정책 정의를 삭제합니다.

1. **태그 및 해당 값 필요**라는 기본 제공 정책 정의를 이니셔티브에서 삭제하고 변경 내용을 저장합니다.

   > **참고**: 이 시점에서 이니셔티브에는 새 리소스를 배포하는 동안 태그 지정 비준수 사항을 자동으로 교정하고 규정 준수 상태를 평가하는 단일 정책이 포함되어 있습니다.

1. Azure Portal의 Cloud Shell에서 PowerShell 세션을 시작합니다. 

   > **참고**: 현재의 Azure 구독에서 Cloud Shell을 처음 시작하는 경우, Cloud Shell 파일을 유지하도록 Azure 파일 공유를 만들라는 메시지가 표시됩니다. 이 경우 기본값을 허용하면 자동으로 생성된 리소스 그룹에서 스토리지 계정이 생성됩니다.

1. Cloud Shell 창에서 다음 명령을 실행합니다.

```pwsh
   Get-AzResource -ResourceGroupName 'az1000101b-RG' | ForEach-Object {Set-AzResource -ResourceId $_.ResourceId -Tag @{environment="lab"} -Force }
```

   > **참고**: 이러한 명령은 리소스 그룹 **az1000101b-RG**의 각 리소스에 값이 **lab**인 **환경** 태그를 할당하여 이미 할당된 태그를 덮어씁니다.
   
   > **참고**: 명령이 성공적으로 완료될 때까지 기다립니다.   

1. Azure Portal에서 **태그** 블레이드로 이동합니다.

1. **태그** 블레이드에서 **환경** 태그의 값을 **lab**으로 설정하여 모든 리소스를 표시합니다. 리소스 그룹 **az1000101b-RG**의 모든 리소스가 나열되는지 확인합니다.


#### 작업 6: 수정 작업이 규정 준수에 미치는 영향을 평가합니다.

1. Azure Portal에서 **리소스 블레이드 만들기**로 이동합니다.

1. **새** 블레이드에서 Azure Marketplace에 **템플릿 배포**를 검색합니다.

1. 검색 결과 목록을 사용하여 **사용자 지정 배포** 블레이드로 이동합니다.

1. **사용자 지정 배포** 블레이드에서 **편집기에서 고유한 템플릿 빌드**를 선택합니다.

1. **템플릿 편집** 블레이드에서 템플릿 파일 **az-100-01b_azuredeploy.json**을 로드합니다. 

   > **참고**: 이 템플릿은 이 연습의 첫 번째 작업에서 배포에 사용한 템플릿과 동일합니다. 

1. 템플릿을 저장하고 **사용자 지정 배포** 블레이드로 돌아갑니다. 

1. **사용자 지정 배포** 블레이드에서 **매개 변수 편집** 블레이드로 이동합니다.

1. **편집 매개 변수** 블레이드에서 매개 변수 파일 **az-100-01b_azuredeploy.parameters.json**을 로드합니다. 

1. 매개 변수를 저장하고 **사용자 지정 배포** 블레이드로 돌아갑니다. 

1. **사용자 지정 배포** 블레이드에서 다음 설정으로 템플릿 배포를 시작합니다:

    - 구독: 이 랩에서 사용 중인 구독의 이름

    - 리소스 그룹: **az1000102b-RG**

    - 위치: 이 연습의 첫 번째 작업에서 선택한 Azure 지역의 이름

    - VM 크기: **Standard_DS1_v2**

    - VM 이름: **az1000102b-vm1**

    - 관리자 사용자 이름: **학생**

    - 관리자 암호: **Pa55w.rd1234**

    - 가상 네트워크 이름: **az1000102b-vnet1**

    - 환경 이름: **lab**

   > **참고**: 이번에는 배포가 성공합니다. 예상한 바와 같습니다.

   > **참고**: 배포가 완료되기를 기다리지 말고 다음 단계를 진행하세요. 

1. Azure Portal에서 **태그** 블레이드로 이동합니다.

1. **태그** 블레이드에서 **환경** 태그의 값을 **lab**으로 설정하여 모든 리소스를 표시합니다. 리소스 그룹 **az1000102b-RG**에 배포된 모든 리소스에는 이 태그가 있습니다. 이 태그에는 동일한 값이 자동으로 할당됩니다.

   > **참고**: 이 시점에서는 일부 리소스만 프로비전되었지만, 모든 리소스에 태그가 할당되었는지 확인해야 합니다.

1. **정책 - 규정 준수** 블레이드로 이동합니다. **규정 준수 상태** 열의 항목을 식별합니다.

1. **az10001b - 태그 지정 이니셔티브 할당** 블레이드로 이동합니다. **규정 준수 상태** 열의 항목을 식별합니다. 열에 **시작되지 않음** 항목이 포함된 경우, 규정 준수 검사가 실행될 때까지 기다립니다. 

   > **참고**: 규정 준수 상태에 대한 업데이트를 보려면 최대 10분까지 기다렸다가 **정책 - 규정 준수** 블레이드에서 **새로 고침** 단추를 클릭합니다. 

   > **참고**: 상태가 준수 목록에 표시될 때까지 기다리지 말고 다음 연습을 진행합니다. 

> **결과**: 이 연습에서는 리소스 태그 지정 규정 준수를 평가, 적용 및 수정하는 이니셔티브와 정책을 구현했습니다. 또한 정책 할당의 효과를 평가했습니다. 


### 연습 2: Azure 리소스 잠금 구현
  
이 연습의 주요 작업은 다음과 같습니다:

1. 리소스 그룹 수준 잠금을 만들어 실수로 인한 변경을 방지

1. 리소스 그룹 수준 잠금 기능의 유효성 검사


#### 작업 1: 리소스 그룹 수준 잠금을 만들어 실수로 인한 변경 방지

1. Azure Portal에서 **az1000101b-RG** 리소스 그룹 블레이드로 이동합니다.

1. **az1000101b-RG** 리소스 그룹 블레이드에서 **az1000101b-RG - 잠금** 블레이드를 표시합니다.

1. **az1000101b-RG - 잠금** 블레이드에서 다음 설정으로 잠금을 추가합니다:

    - 잠금 이름: **az1000101b-roLock**

    - 잠금 유형: **읽기 전용**


#### 작업 2: 리소스 그룹 수준 잠금 기능의 유효성 검사

1. Azure Portal에서 **az1000102b-vm1** 가상 머신 블레이드로 이동합니다.

1. **az1000102b-vm1** 가상 머신 블레이드에서 **az1000102b-vm1 - 태그** 블레이드로 이동합니다.

1. **환경** 태그의 값을 **dev**로 설정해 보십시오. 작업이 성공적으로 완료되었습니다. 

1. Azure Portal에서 **az1000101b-vm1** 가상 머신 블레이드로 이동합니다.

1. **az1000101b-vm1** 가상 머신 블레이드에서 **az1000101b-vm1 - 태그** 블레이드로 이동합니다.

1. **환경** 태그의 값을 **dev**로 설정해 보십시오. 이번에는 작업이 실패합니다. 결과 오류 메시지는 리소스가 태그 할당을 거부했으며, 리소스 잠금이 원인일 수 있음을 나타냅니다.

1. **az1000101b-RG** 리소스 그룹에 생성된 스토리지 계정의 블레이드로 이동합니다. 

1. 스토리지 계정 블레이드에서 **액세스 키** 블레이드로 이동합니다. 데이터 평면에 액세스할 수 없다는 오류 메시지가 표시됩니다. 리소스 또는 해당 부모의 읽기 잠금 때문입니다.

1. Azure Portal에서 **az1000101b-RG** 리소스 그룹 블레이드로 이동합니다.

1. **az1000101b-RG** 리소스 그룹 블레이드에서 **태그** 블레이드로 이동합니다.

1. **태그** 블레이드에서 값이 **lab**인 **환경** 태그를 리소스 그룹에 할당하고 오류 메시지를 확인합니다.


> **결과**: 이 연습에서는 리소스 그룹 수준 잠금을 만들어 실수로 인한 변경을 방지하고 해당 기능의 유효성을 검사했습니다. 

## 연습 3: 랩 리소스 제거

#### 작업 1: 리소스 그룹 수준 잠금 삭제

1. Azure Portal에서 **az1000101b-RG** 리소스 그룹 블레이드로 이동합니다.

1. Azure Portal에서 **az1000101b-RG** 리소스 그룹 블레이드로 이동합니다.

1. **az1000101b-RG** 리소스 그룹 블레이드에서 **az1000101b-RG - 잠금** 블레이드를 표시합니다.

1. **az1000101b-RG - 잠금** 블레이드에서 **az1000101b-roLock**을 삭제합니다.

#### 작업 2: 정책 할당 및 정의 삭제

1. Azure Portal에서 **정책** 블레이드로 이동합니다.

1. **정책** 블레이드에서 **정책 - 할당** 블레이드로 이동합니다. 

1. **정책 - 할당** 블레이드에서 이 랩 앞부분에서 만든 할당을 제거합니다. 

1. **정책** 블레이드에서 **정책 - 정의** 블레이드로 이동합니다. 

1. **정책 - 정의** 블레이드에서 이 랩 앞부분에서 만든 모든 정의를 제거합니다. 

#### 작업 3: Cloud Shell 열기

1. 포털 상단에서 **Cloud Shell** 아이콘을 클릭하여 Cloud Shell 창을 엽니다.

1. Cloud Shell 인터페이스에서 **Bash**를 선택합니다.

1. **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 키를 눌러 이 랩에서 만든 모든 리소스 그룹을 나열합니다.

```sh
   az group list --query "[?starts_with(name,'az100010')].name" --output tsv
```

1. 이 랩에서 만든 리소스 그룹만 출력에 포함되어 있는지 확인합니다. 다음 태스크에서 이러한 그룹을 삭제합니다.

#### 작업 4: 리소스 그룹 삭제

1. **Cloud Shell** 명령 프롬프트에서 다음 명령을 입력하고 **Enter** 키를 눌러 이 랩에서 만든 리소스 그룹을 삭제합니다.

```sh
   az group list --query "[?starts_with(name,'az100010')].name" --output tsv | xargs -L1 bash -c 'az group delete --name $0 --no-wait --yes'
```

1. 포털 하단에 있는 **Cloud Shell** 프롬프트를 닫습니다.

> **결과**: 이 연습에서는 이 랩에서 사용한 리소스를 제거했습니다.
